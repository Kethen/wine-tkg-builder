name: Build package

on: [ push, pull_request, workflow_dispatch ]

jobs:
  build_pkg:
    runs-on: ubuntu-22.04
    steps:

    - name: Checkout
      uses: actions/checkout@v3

    - name: Add 32bit packages
      run: |
        sudo dpkg --add-architecture i386

    - name: Install i386 cargo
      run: |
        sudo apt update
        export DEBIAN_FRONTEND=noninteractive
        sudo apt install -y cargo:i386 git

    - name: Install libwine-dev
      run: |
        sudo apt update
        export DEBIAN_FRONTEND=noninteractive
        sudo apt install -y libwine-dev

    - name: Build
      run: |
        sudo bash -c 'SKIP_PODMAN=true bash build_podman.sh'

    - name: Push package artifact
      uses: actions/upload-artifact@v3
      with:
        name: wine-tkg-proton-freesync
        path: |
           wine-tkg-git/proton-tkg/built/*.tar
        if-no-files-found: error
